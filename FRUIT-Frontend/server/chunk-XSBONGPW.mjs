import './polyfills.server.mjs';
import{a as ee,b as te,c as me}from"./chunk-CWN6KPUA.mjs";import{a as ie}from"./chunk-ZJ7GHIPZ.mjs";import{a as Z}from"./chunk-TXQQKV2F.mjs";import{a as $,b as z,e as J,q as K}from"./chunk-ERC2CRHF.mjs";import{a as q,b as W}from"./chunk-QZQANR5E.mjs";import"./chunk-XZVO5RUM.mjs";import{c as Y,d as Q}from"./chunk-G2EMQGJ6.mjs";import{q as X}from"./chunk-UTIOHHII.mjs";import{$a as T,Ac as U,Bb as k,Cb as L,Db as B,Fb as F,Fc as H,Gb as N,Hb as A,Ma as n,Mb as d,Na as S,Nb as c,Za as b,ab as g,ca as M,eb as o,fb as r,gb as v,jb as G,la as R,lb as u,ma as E,na as h,nb as x,oa as w,qb as D,wb as l,xb as y,yb as p,yc as V,zc as j}from"./chunk-RDXAN74U.mjs";import{g as le}from"./chunk-5XUXGTUW.mjs";var ne=le(me());var I=m=>({"transform rotate-180":m}),de=()=>[];function ce(m,i){m&1&&(h(),v(0,"path",31))}function pe(m,i){if(m&1&&(h(),v(0,"path",32)),m&2){let t=x();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function ge(m,i){m&1&&(h(),v(0,"path",31))}function ue(m,i){if(m&1&&(h(),v(0,"path",32)),m&2){let t=x();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function he(m,i){m&1&&(h(),v(0,"path",31))}function fe(m,i){if(m&1&&(h(),v(0,"path",32)),m&2){let t=x();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function _e(m,i){if(m&1){let t=G();o(0,"tr",33)(1,"td",34),l(2),r(),o(3,"td",34),l(4),r(),o(5,"td",34),l(6),r(),o(7,"td",34),l(8),r(),o(9,"td",34)(10,"span",35),v(11,"span",36),l(12),d(13,"translate"),d(14,"translate"),r()(),o(15,"td",34)(16,"div",37)(17,"button",38),u("click",function(){let a=R(t).$implicit,s=x();return E(s.onEdit(a))}),l(18),d(19,"translate"),r(),o(20,"button",39),u("click",function(){let a=R(t).$implicit,s=x();return E(s.onDelete(a))}),l(21),d(22,"translate"),r(),o(23,"button",40),u("click",function(){let a=R(t).$implicit,s=x();return E(s.onHistoryPlayers(a.id))}),l(24),d(25,"translate"),r()()()()}if(m&2){let t=i.$implicit,e=x();n(2),y(t.id),n(2),y(t.code),n(2),p("",e.formatDate(t.created_at)," "),n(2),p("",e.formatDate(t.expiration_date)," "),n(2),g("ngClass",t.status?"bg-green-100 text-green-800 border-green-300":"bg-red-100 text-red-800 border-red-300"),n(),g("ngClass",t.status?"bg-green-500":"bg-red-500"),n(),p(" ",t.status?c(13,10,"GAME_ROOM.ASSET"):c(14,12,"GAME_ROOM.IDLE")," "),n(6),p(" ",c(19,14,"CREATE_GAME_ROOM.MODAL_EDIT_CREATE_RNF.BUTTON_EDIT_MODAL")," "),n(3),p(" ",c(22,16,"GAME_ROOM.ELIMINATED")," "),n(3),p(" ",c(25,18,"GAME_ROOM.PLAYER_HISTORY")," ")}}function xe(m,i){if(m&1){let t=G();o(0,"button",41),u("click",function(){let a=R(t).index,s=x();return E(s.goToPage(a+1))}),l(1),r()}if(m&2){let t=i.index,e=x();g("ngClass",e.currentPage===t+1?"bg-[#0D92F4] text-white border-blue-500":"bg-gray-100 text-gray-500 border-gray-300 hover:bg-gray-200 hover:text-gray-700"),n(),p(" ",t+1," ")}}var O=class m{constructor(i,t,e,a,s){this.gameRoomsService=i;this.alertService=t;this.loadingService=e;this.router=a;this.storageService=s}gameRooms=[];paginatedData=[];currentPage=1;itemsPerPage=5;selectedFile=null;questions=[];listRnf=[];searchTerm="";sortDirection="asc";sortField="code";filteredGameRooms=[];ngOnInit(){this.getGameRooms()}getGameRooms(){this.loadingService.showLoading(),this.gameRoomsService.getGameRooms().subscribe({next:i=>{this.loadingService.hideLoading(),this.gameRooms=i.data,this.filteredGameRooms=[...this.gameRooms],this.updatePagination()},error:i=>{this.loadingService.hideLoading(),this.alertService.showAlert(i.message,!0)}})}onDelete(i){let t=!1;i.status==!0?t=!1:t=!0,this.loadingService.showLoading(),this.gameRoomsService.deleteGameRoom(i.id,t,this.storageService.getItem()||"es").subscribe({next:e=>{this.loadingService.hideLoading(),this.alertService.showAlert(e.message,!1),this.getGameRooms()},error:e=>{this.loadingService.hideLoading(),this.alertService.showAlert(e.message,!0)}})}onEdit(i){this.loadingService.showLoading(),this.gameRoomsService.getGameRoomQuestions(i.id).subscribe({next:t=>{this.loadingService.hideLoading(),this.questions=t.questions,this.router.navigate(["/edit-game-room",i.id],{state:{questions:this.questions,gameRoom:i}})},error:t=>{this.loadingService.hideLoading(),this.alertService.showAlert(t.message,!0)}})}transformExcelToCsv(i){return new Promise((t,e)=>{let a=new FileReader;a.onload=s=>{let f=new Uint8Array(s.target.result),_=new Array;for(let C=0;C!==f.length;++C)_[C]=String.fromCharCode(f[C]);let oe=_.join(""),P=ee(oe,{type:"binary"}),re=P.SheetNames[0],ae=P.Sheets[re],se=te.sheet_to_csv(ae);t(se)},a.onerror=s=>e(s),a.readAsArrayBuffer(i)})}parseCsvToArray(i){ne.parse(i,{header:!0,skipEmptyLines:!0,complete:t=>{this.listRnf=t.data,this.gameRoomsService.uploadExcel(this.listRnf).subscribe({next:e=>{this.loadingService.hideLoading(),this.alertService.showAlert(e.message,!1),this.getGameRooms()},error:e=>{this.loadingService.hideLoading(),this.alertService.showAlert("Error al subir el archivo",!0),console.error("Error al subir archivo:",e)}})},error:t=>{console.error("Error parsing CSV:",t)}})}onFileSelected(i){let t=i.target;if(t.files&&t.files.length>0){let e=t.files[0];if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(e.type)){this.alertService.showAlert("Solo se permiten archivos Excel (.xls, .xlsx)",!0),t.value="";return}this.loadingService.showLoading(),this.transformExcelToCsv(e).then(s=>{this.parseCsvToArray(s),this.loadingService.hideLoading(),t.value=""}).catch(s=>{t.value="",this.loadingService.hideLoading(),this.alertService.showAlert("Error al subir el archivo",s)})}}updatePagination(){let i=(this.currentPage-1)*this.itemsPerPage,t=i+this.itemsPerPage;this.paginatedData=this.filteredGameRooms.slice(i,t)}goToPage(i){this.currentPage=i,this.updatePagination()}nextPage(){this.currentPage*this.itemsPerPage<this.gameRooms.length&&(this.currentPage++,this.updatePagination())}prevPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}get totalPages(){return Math.ceil(this.filteredGameRooms.length/this.itemsPerPage)}formatDate(i){let t=new Date(i),e={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"};return t.toLocaleDateString("es-ES",e).replace(",","")}goToCreateGameRoom(){this.router.navigate(["/create-game-room"])}searchGameRooms(){this.filteredGameRooms=this.gameRooms.filter(i=>i.code.toLowerCase().includes(this.searchTerm.toLowerCase())),this.sortGameRooms(),this.currentPage=1,this.updatePagination()}sortGameRooms(){let i="1969-12-31T19:00:00";this.filteredGameRooms.sort((t,e)=>{if(this.sortField==="code"){let a=t.code.toLowerCase(),s=e.code.toLowerCase();return this.sortDirection==="asc"?a.localeCompare(s):s.localeCompare(a)}else if(this.sortField==="createdAt"){let a=t.created_at||t.createdAt||i,s=e.created_at||e.createdAt||i;(!a||!s)&&console.warn("Using default date for missing field:",{a:t,b:e});let f=new Date(a).getTime(),_=new Date(s).getTime();return isNaN(f)||isNaN(_)?(console.error("Invalid date format, using default:",{dateA:f,dateB:_}),0):this.sortDirection==="asc"?f-_:_-f}else if(this.sortField==="expirationAt"){let a=t.expiration_date||t.expirationAt||i,s=e.expiration_date||e.expirationAt||i;if(!a||!s)return console.warn("Missing date field:",{a:t,b:e}),0;let f=new Date(a).getTime(),_=new Date(s).getTime();return this.sortDirection==="asc"?f-_:_-f}}),this.updatePagination()}toggleSort(i){this.sortField===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=i,this.sortDirection="asc"),this.sortGameRooms(),this.updatePagination()}onHistoryPlayers(i){this.router.navigate(["/get-participating-players",i])}static \u0275fac=function(t){return new(t||m)(S(ie),S(W),S(q),S(X),S(Z))};static \u0275cmp=M({type:m,selectors:[["app-game-rooms"]],standalone:!0,features:[F],decls:80,vars:65,consts:[[1,"py-5"],[1,"flex","flex-wrap","gap-4","mb-6","items-center","justify-between"],[1,"flex","items-center","gap-2","px-4","py-2","text-white","bg-[#28A745]","rounded-lg","shadow-md","hover:bg-green-700","focus:outline-none","transition","duration-300","w-full","sm:w-auto","text-center","justify-center",3,"click"],[1,"material-icons","text-base"],[1,"flex","flex-col","sm:flex-row","items-center","gap-4","w-full","sm:w-auto"],[1,"flex","items-center","gap-2"],["for","fileInput",1,"text-sm","font-medium","text-gray-700"],["id","fileInput","type","file","accept",".xlsx, .xls",1,"w-auto","px-3","py-2","text-sm","border","border-gray-300","rounded-lg","shadow-sm","focus:ring-blue-500","focus:border-blue-500","transition","duration-300","cursor-pointer",3,"change"],["href","https://franklinparrales.es/RECURSOS/FRUIT-example.xlsx","download","example.xlsx",1,"flex","items-center","bg-green-500","text-white","font-medium","px-4","py-2","rounded-lg","shadow-md","hover:bg-green-600","transition","duration-300"],[1,"material-icons","pr-1"],[1,"mb-6","p-4","bg-white","rounded-lg","shadow-md"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"relative","flex-1"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text",1,"w-full","pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition","duration-150","ease-in-out",3,"ngModelChange","input","ngModel","placeholder"],[1,"flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","px-4","py-2","bg-white","border","border-gray-300","rounded-lg","text-sm","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","transition","duration-150","ease-in-out",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"ml-2","h-5","w-5",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2",4,"ngIf"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","table-auto"],[1,"bg-[#0D92F4]","text-white"],[1,"px-4","py-3","text-left","text-sm","font-medium","uppercase","tracking-wider","whitespace-nowrap"],["class","odd:bg-gray-50 even:bg-gray-100 hover:bg-gray-200",4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","mt-6","space-x-2"],[1,"px-4","py-2","text-sm","font-medium","text-gray-500","bg-gray-100","border","border-gray-300","rounded-md","hover:bg-gray-200","hover:text-gray-700","transition-colors","duration-300",3,"click","disabled","ngClass"],["class","px-4 py-2 text-sm font-medium border rounded-md transition-colors duration-300",3,"ngClass","click",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"odd:bg-gray-50","even:bg-gray-100","hover:bg-gray-200"],[1,"px-4","py-4","text-sm","text-gray-700","whitespace-nowrap"],[1,"inline-flex","items-center","gap-2","px-3","py-1","text-xs","font-medium","border","rounded-full",3,"ngClass"],[1,"w-2.5","h-2.5","rounded-full",3,"ngClass"],[1,"flex","gap-2"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#0D92F4]","rounded","hover:bg-blue-700","focus:outline-none",3,"click"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#C62E2E]","rounded","hover:bg-red-700","focus:outline-none",3,"click"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#6C757D]","rounded","hover:bg-[#6C757D]","focus:outline-none",3,"click"],[1,"px-4","py-2","text-sm","font-medium","border","rounded-md","transition-colors","duration-300",3,"click","ngClass"]],template:function(t,e){t&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),u("click",function(){return e.goToCreateGameRoom()}),o(3,"span",3),l(4,"add"),r(),l(5),d(6,"translate"),r(),o(7,"div",4)(8,"div",5)(9,"label",6),l(10),d(11,"translate"),r(),o(12,"input",7),u("change",function(s){return e.onFileSelected(s)}),r()(),o(13,"a",8)(14,"span",9),l(15,"download"),r(),l(16),d(17,"translate"),r()()(),o(18,"div",10)(19,"div",11)(20,"div",12)(21,"div",13),h(),o(22,"svg",14),v(23,"path",15),r()(),w(),o(24,"input",16),d(25,"translate"),B("ngModelChange",function(s){return L(e.searchTerm,s)||(e.searchTerm=s),s}),u("input",function(){return e.searchGameRooms()}),r()(),o(26,"div",17)(27,"button",18),u("click",function(){return e.toggleSort("code")}),o(28,"span"),l(29),d(30,"translate"),r(),h(),o(31,"svg",19),b(32,ce,1,0,"path",20)(33,pe,1,1,"path",21),r()(),w(),o(34,"button",18),u("click",function(){return e.toggleSort("expirationAt")}),o(35,"span"),l(36),d(37,"translate"),r(),h(),o(38,"svg",19),b(39,ge,1,0,"path",20)(40,ue,1,1,"path",21),r()(),w(),o(41,"button",18),u("click",function(){return e.toggleSort("createdAt")}),o(42,"span"),l(43),d(44,"translate"),r(),h(),o(45,"svg",19),b(46,he,1,0,"path",20)(47,fe,1,1,"path",21),r()()()()(),w(),o(48,"div",22)(49,"div",23)(50,"table",24)(51,"thead",25)(52,"tr")(53,"th",26),l(54," Id"),r(),o(55,"th",26),l(56),d(57,"translate"),r(),o(58,"th",26),l(59),d(60,"translate"),r(),o(61,"th",26),l(62),d(63,"translate"),r(),o(64,"th",26),l(65),d(66,"translate"),r(),o(67,"th",26),l(68),d(69,"translate"),r()()(),o(70,"tbody"),b(71,_e,26,20,"tr",27),r()()()(),o(72,"div",28)(73,"button",29),u("click",function(){return e.prevPage()}),l(74),d(75,"translate"),r(),b(76,xe,2,2,"button",30),o(77,"button",29),u("click",function(){return e.nextPage()}),l(78),d(79,"translate"),r()()()),t&2&&(n(5),p(" ",c(6,30,"GAME_ROOM.BUTTON_CREATE")," "),n(5),p(" ",c(11,32,"GAME_ROOM.UPLOAD_QUESTION")," "),n(6),p(" ",c(17,34,"GAME_ROOM.EXCEL_FILE")," "),n(8),D("placeholder",c(25,36,"GAME_ROOM.SEARCH_PLACEHOLDER")),k("ngModel",e.searchTerm),n(5),y(c(30,38,"GAME_ROOM.SORT_BY_CODE")),n(2),g("ngClass",A(58,I,e.sortField==="code"&&e.sortDirection==="desc")),n(),g("ngIf",e.sortField!=="code"),n(),g("ngIf",e.sortField==="code"),n(3),y(c(37,40,"GAME_ROOM.SORT_BY_EXPIRATION")),n(2),g("ngClass",A(60,I,e.sortField==="expirationAt"&&e.sortDirection==="desc")),n(),g("ngIf",e.sortField!=="expirationAt"),n(),g("ngIf",e.sortField==="expirationAt"),n(3),y(c(44,42,"GAME_ROOM.SORT_BY_DATE")),n(2),g("ngClass",A(62,I,e.sortField==="createdAt"&&e.sortDirection==="desc")),n(),g("ngIf",e.sortField!=="createdAt"),n(),g("ngIf",e.sortField==="createdAt"),n(9),p(" ",c(57,44,"TABLE.CODE"),""),n(3),p(" ",c(60,46,"TABLE.CREATION_DATE"),""),n(3),p(" ",c(63,48,"TABLE.EXPIRATION_DATE"),""),n(3),p(" ",c(66,50,"TABLE.STATUS"),""),n(3),p(" ",c(69,52,"TABLE.ACTIONS"),""),n(3),g("ngForOf",e.paginatedData),n(2),g("disabled",e.currentPage===1)("ngClass",e.currentPage===1?"opacity-50 cursor-not-allowed":""),n(),p(" \xAB ",c(75,54,"BUTTON_NAVIGATION_TABLE.PREVIOUS")," "),n(2),g("ngForOf",N(64,de).constructor(e.totalPages)),n(),g("disabled",e.currentPage===e.totalPages)("ngClass",e.currentPage===e.totalPages?"opacity-50 cursor-not-allowed":""),n(),p(" ",c(79,56,"BUTTON_NAVIGATION_TABLE.NEXT")," \xBB "))},dependencies:[H,V,j,U,Q,Y,K,$,z,J],styles:[".search-sort-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.search-box[_ngcontent-%COMP%]{flex:0 0 300px}.sort-buttons[_ngcontent-%COMP%]{display:flex;gap:10px}"]})};export{O as default};
