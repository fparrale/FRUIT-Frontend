import './polyfills.server.mjs';
import{a as ne,b as re,e as oe,q as ae}from"./chunk-ERC2CRHF.mjs";import{a as X,b as ee}from"./chunk-QZQANR5E.mjs";import{a as te,b as ie}from"./chunk-XZVO5RUM.mjs";import{c as J,d as Z}from"./chunk-G2EMQGJ6.mjs";import{a as Q,b as Y}from"./chunk-UTIOHHII.mjs";import{$a as B,A as D,Ac as K,Bb as L,Cb as V,Db as U,Fb as j,Fc as q,Gb as $,Hb as O,Ma as t,Mb as p,Na as T,Nb as c,R as M,U as F,Z as H,Za as _,ab as d,ca as N,eb as a,fb as r,gb as S,jb as A,l as k,la as I,lb as h,ma as E,na as b,nb as f,oa as w,qb as R,wb as s,xb as g,yb as u,yc as W,zc as z}from"./chunk-RDXAN74U.mjs";import"./chunk-5XUXGTUW.mjs";var G=class i{constructor(n,e){this.http=n;this.authService=e}apiUrl=te.apiUrl+"game/game-history";getGameHistory(){let n=this.authService.getUserData(),e=new Q({Authorization:`Bearer ${n?.access_token}`});return this.http.get(this.apiUrl,{headers:e}).pipe(M(o=>o),D(o=>k(()=>new Error(o.error.message||"Ocurrio un error intentalo mas tarde"))))}static \u0275fac=function(e){return new(e||i)(H(Y),H(ie))};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};var se=i=>({"transform rotate-180":i}),pe=()=>[];function ce(i,n){i&1&&(b(),S(0,"path",23))}function me(i,n){if(i&1&&(b(),S(0,"path",24)),i&2){let e=f();B("d",e.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function ge(i,n){i&1&&(b(),S(0,"path",23))}function ue(i,n){if(i&1&&(b(),S(0,"path",24)),i&2){let e=f();B("d",e.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function _e(i,n){i&1&&(a(0,"span",43),s(1,"\u2714"),r())}function fe(i,n){i&1&&(a(0,"span",44),s(1,"\u2718"),r())}function xe(i,n){if(i&1&&(a(0,"p",45)(1,"strong"),s(2),p(3,"translate"),r(),s(4),p(5,"translate"),r()),i&2){let e=f().$implicit;t(2),g(c(3,2,"RESULTS.FEEDBACK")),t(2),u(" ",e.feedback_variable||c(5,4,"NO_FEEDBACK")," ")}}function ve(i,n){i&1&&(a(0,"span",43),s(1,"\u2714"),r())}function he(i,n){i&1&&(a(0,"span",44),s(1,"\u2718"),r())}function ye(i,n){if(i&1&&(a(0,"p",45)(1,"strong"),s(2),p(3,"translate"),r(),s(4),p(5,"translate"),r()),i&2){let e=f().$implicit;t(2),g(c(3,2,"RESULTS.FEEDBACK")),t(2),u(" ",e.feedback_value||c(5,4,"NO_FEEDBACK")," ")}}function be(i,n){i&1&&(a(0,"span",43),s(1,"\u2714"),r())}function Se(i,n){i&1&&(a(0,"span",44),s(1,"\u2718"),r())}function Ie(i,n){if(i&1&&(a(0,"p",45)(1,"strong"),s(2),p(3,"translate"),r(),s(4),p(5,"translate"),r()),i&2){let e=f().$implicit;t(2),g(c(3,2,"RESULTS.FEEDBACK")),t(2),u(" ",e.feedback_recomend||c(5,4,"NO_FEEDBACK")," ")}}function Ee(i,n){i&1&&S(0,"hr",46)}function Ce(i,n){if(i&1&&(a(0,"li",35)(1,"p")(2,"strong",36),s(3),p(4,"translate"),r(),s(5),r(),a(6,"div",37)(7,"strong",36),s(8),p(9,"translate"),r(),a(10,"span",38),s(11),r(),a(12,"span"),_(13,_e,2,0,"span",39)(14,fe,2,0,"span",40),r()(),_(15,xe,6,6,"p",41),a(16,"div",37)(17,"strong",36),s(18),p(19,"translate"),r(),a(20,"span",38),s(21),r(),a(22,"span"),_(23,ve,2,0,"span",39)(24,he,2,0,"span",40),r()(),_(25,ye,6,6,"p",41),a(26,"div",37)(27,"strong",36),s(28),p(29,"translate"),r(),a(30,"span",38),s(31),r(),a(32,"span"),_(33,be,2,0,"span",39)(34,Se,2,0,"span",40),r()(),_(35,Ie,6,6,"p",41)(36,Ee,1,0,"hr",42),r()),i&2){let e=n.$implicit,o=n.last;t(3),u("",c(4,18,"QUESTION.NFR"),":"),t(2),u(" ",e.nfr," "),t(3),g(c(9,20,"MODAL_CONFIRMATION.LINGUISTIC_VARIABLE")),t(3),u("(",e.user_variable,")"),t(2),d("ngIf",e.correct_variable),t(),d("ngIf",!e.correct_variable),t(),d("ngIf",!e.correct_variable),t(3),g(c(19,22,"MODAL_CONFIRMATION.LINGUISTIC_VALUE")),t(3),u("(",e.user_value,")"),t(2),d("ngIf",e.correct_value),t(),d("ngIf",!e.correct_value),t(),d("ngIf",!e.correct_value),t(3),g(c(29,24,"MODAL_CONFIRMATION.LINGUISTIC_RECOMMENDATION")),t(3),u("(",e.user_recomend,")"),t(2),d("ngIf",e.correct_recomend),t(),d("ngIf",!e.correct_recomend),t(),d("ngIf",!e.correct_recomend),t(),d("ngIf",!o)}}function we(i,n){if(i&1){let e=A();a(0,"div",25)(1,"div",26)(2,"div",27)(3,"h3",28),s(4),p(5,"translate"),r()(),a(6,"div",29)(7,"ul",30),_(8,Ce,37,26,"li",31),r()(),a(9,"div",32)(10,"button",33),h("click",function(){I(e);let l=f();return E(l.closeModal())}),s(11),p(12,"translate"),r(),a(13,"button",34),h("click",function(){I(e);let l=f();return E(l.printResults())}),s(14),p(15,"translate"),r()()()()}if(i&2){let e=f();t(4),g(c(5,4,"TABLE.ANSWERS")),t(4),d("ngForOf",e.selectedAnswers),t(3),u(" ",c(12,6,"ALERT.BUTTON_CLOSE")," "),t(3),u(" ",c(15,8,"ALERT.PRINT")," ")}}function Te(i,n){if(i&1){let e=A();a(0,"tr",47)(1,"td",48),s(2),r(),a(3,"td",48),s(4),r(),a(5,"td",48),s(6),r(),a(7,"td",49),s(8),r(),a(9,"td",48),s(10),r(),a(11,"td",48)(12,"button",50),h("click",function(){let l=I(e).$implicit,m=f();return E(m.openAnswersModal(l.answered_questions,l))}),s(13),p(14,"translate"),r()()()}if(i&2){let e=n.$implicit;t(2),g(e.id),t(2),g(e.game_room.code),t(2),g(e.created_at),t(),d("ngClass",e.score>=70?"text-green-500":"text-red-500"),t(),u(" ",e.score," / 100 "),t(2),g(e.duration),t(3),u(" ",c(14,7,"TABLE.VIEW_ANSWERS")," ")}}function Ae(i,n){if(i&1){let e=A();a(0,"button",51),h("click",function(){let l=I(e).index,m=f();return E(m.goToPage(l+1))}),s(1),r()}if(i&2){let e=n.index,o=f();d("ngClass",o.currentPage===e+1?"bg-[#0D92F4] text-white border-blue-500":"bg-gray-100 text-gray-500 border-gray-300 hover:bg-gray-200 hover:text-gray-700"),t(),u(" ",e+1," ")}}var P=class i{constructor(n,e,o){this.gameHistoryService=n;this.alertService=e;this.loadingService=o}gameHistory=[];paginatedData=[];currentPage=1;itemsPerPage=5;searchTerm="";sortDirection="asc";sortField="code";filteredGameRooms=[];showModal=!1;selectedAnswers=[];gameHistoryPrint={};ngOnInit(){this.getGameHistory()}getGameHistory(){this.loadingService.showLoading(),this.gameHistoryService.getGameHistory().subscribe({next:n=>{this.loadingService.hideLoading(),this.gameHistory=n.data,this.filteredGameRooms=[...this.gameHistory],this.updatePagination()},error:n=>{this.loadingService.hideLoading(),this.alertService.showAlert(n.message,!0)}})}updatePagination(){let n=(this.currentPage-1)*this.itemsPerPage,e=n+this.itemsPerPage;this.paginatedData=this.filteredGameRooms.slice(n,e)}goToPage(n){this.currentPage=n,this.updatePagination()}nextPage(){this.currentPage*this.itemsPerPage<this.gameHistory.length&&(this.currentPage++,this.updatePagination())}prevPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}get totalPages(){return Math.ceil(this.filteredGameRooms.length/this.itemsPerPage)}searchGameRooms(){this.filteredGameRooms=this.gameHistory.filter(n=>(n.game_room?.code||n.game_room.code||"").toLowerCase().includes(this.searchTerm.toLowerCase())),this.sortGameRooms(),this.currentPage=1,this.updatePagination()}sortGameRooms(){let n="1969-12-31T19:00:00";this.filteredGameRooms.sort((e,o)=>{if(this.sortField==="code"){let l=(e.game_room?.code||e.code||"").toLowerCase(),m=(o.game_room?.code||o.code||"").toLowerCase();return this.sortDirection==="asc"?l.localeCompare(m):m.localeCompare(l)}else if(this.sortField==="createdAt"){let l=e.created_at||e.createdAt||n,m=o.created_at||o.createdAt||n;(!l||!m)&&console.warn("Using default date for missing field:",{a:e,b:o});let y=new Date(l).getTime(),x=new Date(m).getTime();return isNaN(y)||isNaN(x)?(console.error("Invalid date format, using default:",{dateA:y,dateB:x}),0):this.sortDirection==="asc"?y-x:x-y}else if(this.sortField==="expirationAt"){let l=e.expiration_date||e.expirationAt||n,m=o.expiration_date||o.expirationAt||n;if(!l||!m)return console.warn("Missing date field:",{a:e,b:o}),0;let y=new Date(l).getTime(),x=new Date(m).getTime();return this.sortDirection==="asc"?y-x:x-y}}),this.updatePagination()}toggleSort(n){this.sortField===n?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=n,this.sortDirection="asc"),this.sortGameRooms(),this.updatePagination()}openAnswersModal(n,e){this.selectedAnswers=n,this.gameHistoryPrint=e,this.showModal=!0}closeModal(){this.showModal=!1,this.selectedAnswers=[],this.gameHistoryPrint={}}printResults(){let n=document.getElementById("print-content"),e=this.gameHistoryPrint,o=e.score,l=e.user.names,m=e.user.surnames,y=e.duration,x=e.game_room.code;if(n){document.title=`Resultados - ${m} ${l} - ${x}`;let v=document.createElement("iframe");v.style.position="absolute",v.style.width="0",v.style.height="0",v.style.border="none",document.body.appendChild(v);let C=v.contentWindow?.document||v.contentDocument;C&&(C.open(),C.write(`
          <html>
            <head>
            <title>Resultados - ${m} ${l} - ${x}</title>
              <style>
                body {
                  font-family: Arial, sans-serif;
                  margin: 20px;
                  color: #4a5568;
                }
                .header {
                  margin-bottom: 20px;
                  border-bottom: 1px solid #e2e8f0;
                  position: relative;
                }
                .score-box {
                  position: absolute;
                  top: 0;
                  right: 10px;
                  padding: 10px;
                  border: 2px solid #4a5568;
                  font-weight: bold;
                  font-size: 16px;
                  text-align: center;
                  color: #4a5568;
                  background-color: #f1f5f9;
                }
                .font-bold {
                  font-weight: bold;
                }
                .text-gray-700 {
                  color: #4a5568;
                }
                .text-green-500 {
                  color: #48bb78;
                }
                .text-red-500 {
                  color: #f56565;
                }
                .text-sm {
                  font-size: 0.875rem;
                }
              </style>
            </head>
            <body>
              <div class="header">
                <div class="score-box">
                  SCORE<br>${o} / 100
                </div>
                <h2 class="font-bold text-gray-700">Resultado</h2>
                <p><strong>Nombres:</strong> ${l}</p>
                <p><strong>Apellidos:</strong> ${m}</p>
                <p><strong>Duraci\xF3n:</strong> ${y}</p>
                <p><strong>C\xF3digo de sala:</strong> ${x}</p>
              </div>
              ${n.outerHTML}
            </body>
          </html>
        `),C.close()),v.onload=()=>{v.contentWindow?.print(),document.title="FRUIT",document.body.removeChild(v)}}else console.error("No se encontr\xF3 el contenido a imprimir.")}static \u0275fac=function(e){return new(e||i)(T(G),T(ee),T(X))};static \u0275cmp=N({type:i,selectors:[["app-game-history"]],standalone:!0,features:[j],decls:57,vars:49,consts:[[1,"mb-6","p-4","bg-white","rounded-lg","shadow-md"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"relative","flex-1"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text",1,"w-full","pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition","duration-150","ease-in-out",3,"ngModelChange","input","ngModel","placeholder"],[1,"flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","px-4","py-2","bg-white","border","border-gray-300","rounded-lg","text-sm","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","transition","duration-150","ease-in-out",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"ml-2","h-5","w-5",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2",4,"ngIf"],["class","fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",4,"ngIf"],[1,"py-10"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","table-auto"],[1,"bg-[#0D92F4]","text-white"],[1,"px-4","py-3","text-left","text-sm","font-medium","uppercase","tracking-wider","whitespace-nowrap"],["class","odd:bg-gray-50 even:bg-gray-100 hover:bg-gray-200",4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","mt-6","space-x-2"],[1,"px-4","py-2","text-sm","font-medium","text-gray-500","bg-gray-100","border","border-gray-300","rounded-md","hover:bg-gray-200","hover:text-gray-700","transition-colors","duration-300",3,"click","disabled","ngClass"],["class","px-4 py-2 text-sm font-medium border rounded-md transition-colors duration-300",3,"ngClass","click",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"fixed","inset-0","flex","items-center","justify-center","z-50","bg-black","bg-opacity-50"],[1,"bg-white","rounded-lg","shadow-lg","w-4/5","max-w-lg"],[1,"px-4","pt-4","border-b","border-gray-200"],[1,"text-xl","font-bold","text-gray-800","m-0"],[1,"p-6","max-h-[70vh]","overflow-y-auto"],["id","print-content",1,"space-y-6"],["class","text-gray-700",4,"ngFor","ngForOf"],[1,"p-4","border-t","border-gray-200","flex","justify-end"],[1,"px-6","py-2","bg-red-500","text-white","text-sm","font-semibold","rounded-lg","shadow","hover:bg-red-600","focus:outline-none","focus:ring","focus:ring-red-300","transition",3,"click"],[1,"ml-4","px-6","py-2","bg-blue-500","text-white","text-sm","font-semibold","rounded-lg","shadow","hover:bg-blue-600","focus:outline-none","focus:ring","focus:ring-blue-300","transition",3,"click"],[1,"text-gray-700"],[1,"font-semibold"],[1,"flex","items-center","space-x-2"],[1,"text-sm","text-gray-600"],["class","text-green-500 text-lg font-bold",4,"ngIf"],["class","text-red-500 text-lg font-bold",4,"ngIf"],["class","text-sm text-red-500",4,"ngIf"],["class","mt-6 border-t border-gray-300",4,"ngIf"],[1,"text-green-500","text-lg","font-bold"],[1,"text-red-500","text-lg","font-bold"],[1,"text-sm","text-red-500"],[1,"mt-6","border-t","border-gray-300"],[1,"odd:bg-gray-50","even:bg-gray-100","hover:bg-gray-200"],[1,"px-4","py-4","text-sm","text-gray-700","whitespace-nowrap"],[1,"px-4","py-4","text-sm","font-semibold",3,"ngClass"],[1,"px-4","py-2","bg-blue-500","text-white","rounded-lg","hover:bg-blue-600","transition-colors","duration-300",3,"click"],[1,"px-4","py-2","text-sm","font-medium","border","rounded-md","transition-colors","duration-300",3,"click","ngClass"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),b(),a(4,"svg",4),S(5,"path",5),r()(),w(),a(6,"input",6),p(7,"translate"),U("ngModelChange",function(m){return V(o.searchTerm,m)||(o.searchTerm=m),m}),h("input",function(){return o.searchGameRooms()}),r()(),a(8,"div",7)(9,"button",8),h("click",function(){return o.toggleSort("code")}),a(10,"span"),s(11),p(12,"translate"),r(),b(),a(13,"svg",9),_(14,ce,1,0,"path",10)(15,me,1,1,"path",11),r()(),w(),a(16,"button",8),h("click",function(){return o.toggleSort("createdAt")}),a(17,"span"),s(18),p(19,"translate"),r(),b(),a(20,"svg",9),_(21,ge,1,0,"path",10)(22,ue,1,1,"path",11),r()()()()(),_(23,we,16,10,"div",12),w(),a(24,"div",13)(25,"div",14)(26,"div",15)(27,"table",16)(28,"thead",17)(29,"tr")(30,"th",18),s(31,"Id"),r(),a(32,"th",18),s(33),p(34,"translate"),r(),a(35,"th",18),s(36),p(37,"translate"),r(),a(38,"th",18),s(39),p(40,"translate"),r(),a(41,"th",18),s(42),p(43,"translate"),r(),a(44,"th",18),s(45),p(46,"translate"),r()()(),a(47,"tbody"),_(48,Te,15,9,"tr",19),r()()()(),a(49,"div",20)(50,"button",21),h("click",function(){return o.prevPage()}),s(51),p(52,"translate"),r(),_(53,Ae,2,2,"button",22),a(54,"button",21),h("click",function(){return o.nextPage()}),s(55),p(56,"translate"),r()()()),e&2&&(t(6),R("placeholder",c(7,24,"GAME_ROOM.SEARCH_PLACEHOLDER")),L("ngModel",o.searchTerm),t(5),g(c(12,26,"GAME_ROOM.SORT_BY_CODE")),t(2),d("ngClass",O(44,se,o.sortField==="code"&&o.sortDirection==="desc")),t(),d("ngIf",o.sortField!=="code"),t(),d("ngIf",o.sortField==="code"),t(3),g(c(19,28,"GAME_ROOM.SORT_BY_DATE")),t(2),d("ngClass",O(46,se,o.sortField==="createdAt"&&o.sortDirection==="desc")),t(),d("ngIf",o.sortField!=="createdAt"),t(),d("ngIf",o.sortField==="createdAt"),t(),d("ngIf",o.showModal),t(10),g(c(34,30,"TABLE.CODE")),t(3),g(c(37,32,"TABLE.CREATION_DATE")),t(3),g(c(40,34,"TABLE.SCORE")),t(3),g(c(43,36,"TABLE.DURATION")),t(3),g(c(46,38,"TABLE.ACTIONS")),t(3),d("ngForOf",o.paginatedData),t(2),d("disabled",o.currentPage===1)("ngClass",o.currentPage===1?"opacity-50 cursor-not-allowed":""),t(),u(" \xAB ",c(52,40,"BUTTON_NAVIGATION_TABLE.PREVIOUS")," "),t(2),d("ngForOf",$(48,pe).constructor(o.totalPages)),t(),d("disabled",o.currentPage===o.totalPages)("ngClass",o.currentPage===o.totalPages?"opacity-50 cursor-not-allowed":""),t(),u(" ",c(56,42,"BUTTON_NAVIGATION_TABLE.NEXT"),"\xBB "))},dependencies:[q,W,z,K,Z,J,ae,ne,re,oe]})};export{P as default};
