import{a as Z}from"./chunk-REPWG47S.js";import{a as H,b as W,e as X,q as Y}from"./chunk-LMQWO4W5.js";import{a as Q}from"./chunk-QMIFJZ5Y.js";import{a as J,b as K}from"./chunk-JTD2GUQY.js";import"./chunk-EOS4WQRA.js";import{c as z,d as q}from"./chunk-JOV6O4AC.js";import"./chunk-24SHYF34.js";import{Ab as d,Ac as U,Bb as R,Cb as f,Fb as O,Gb as F,Hb as B,Jb as M,Kb as L,Lb as C,Qa as n,Qb as c,Ra as y,Rb as m,bb as S,db as T,eb as p,ia as k,ib as o,jb as s,kb as v,nb as E,pb as _,ra as w,rb as x,sa as A,ta as u,tc as N,ua as b,ub as G,uc as V,vc as j}from"./chunk-NJXLY5TY.js";var I=r=>({"transform rotate-180":r}),$=()=>[];function ee(r,i){r&1&&(u(),v(0,"path",22))}function te(r,i){if(r&1&&(u(),v(0,"path",23)),r&2){let t=x();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function ie(r,i){r&1&&(u(),v(0,"path",22))}function ne(r,i){if(r&1&&(u(),v(0,"path",23)),r&2){let t=x();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function oe(r,i){r&1&&(u(),v(0,"path",22))}function re(r,i){if(r&1&&(u(),v(0,"path",23)),r&2){let t=x();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function ae(r,i){if(r&1){let t=E();o(0,"tr",24)(1,"td",25),d(2),s(),o(3,"td",25),d(4),s(),o(5,"td",25),d(6),s(),o(7,"td",25),d(8),s(),o(9,"td",25)(10,"div",26)(11,"button",27),_("click",function(){let a=w(t).$implicit,l=x();return A(l.onGenerateReportGameRoom(a))}),d(12),c(13,"translate"),s()()()()}if(r&2){let t=i.$implicit,e=x();n(2),R(t.id),n(2),R(t.code),n(2),f("",e.formatDate(t.created_at)," "),n(2),f("",e.formatDate(t.expiration_date)," "),n(4),f(" ",m(13,5,"REPORT.GENERATE_REPORT")," ")}}function se(r,i){if(r&1){let t=E();o(0,"button",28),_("click",function(){let a=w(t).index,l=x();return A(l.goToPage(a+1))}),d(1),s()}if(r&2){let t=i.index,e=x();p("ngClass",e.currentPage===t+1?"bg-[#0D92F4] text-white border-blue-500":"bg-gray-100 text-gray-500 border-gray-300 hover:bg-gray-200 hover:text-gray-700"),n(),f(" ",t+1," ")}}var P=class r{constructor(i,t,e,a){this.gameRoomsService=i;this.alertService=t;this.loadingService=e;this.serviceStorage=a}gameRooms=[];paginatedData=[];currentPage=1;itemsPerPage=5;selectedFile=null;searchTerm="";sortDirection="asc";sortField="code";filteredGameRooms=[];ngOnInit(){this.getGameRooms()}getGameRooms(){this.loadingService.showLoading(),this.gameRoomsService.getGameRooms().subscribe({next:i=>{this.loadingService.hideLoading(),this.gameRooms=i.data,this.filteredGameRooms=[...this.gameRooms],this.updatePagination()},error:i=>{this.loadingService.hideLoading(),this.alertService.showAlert(i.message,!0)}})}onGenerateReportGameRoom(i){this.loadingService.showLoading(),this.gameRoomsService.generateReportGameRoom(i.id,this.serviceStorage.getItem()||"es").subscribe({next:t=>{let e=t.headers.get("Content-Disposition"),a="reporte.pdf";if(e){let D=e.match(/filename="(.+)"/);D&&(a=D[1])}let l=t.body,h=window.URL.createObjectURL(l),g=document.createElement("a");g.href=h,g.download=a,g.click(),window.URL.revokeObjectURL(h),this.loadingService.hideLoading()},error:t=>{this.loadingService.hideLoading(),this.alertService.showAlert(t.message,!0)}})}updatePagination(){let i=(this.currentPage-1)*this.itemsPerPage,t=i+this.itemsPerPage;this.paginatedData=this.filteredGameRooms.slice(i,t)}goToPage(i){this.currentPage=i,this.updatePagination()}nextPage(){this.currentPage*this.itemsPerPage<this.gameRooms.length&&(this.currentPage++,this.updatePagination())}prevPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}get totalPages(){return Math.ceil(this.filteredGameRooms.length/this.itemsPerPage)}formatDate(i){let t=new Date(i),e={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"};return t.toLocaleDateString("es-ES",e).replace(",","")}searchGameRooms(){this.filteredGameRooms=this.gameRooms.filter(i=>i.code.toLowerCase().includes(this.searchTerm.toLowerCase())),this.sortGameRooms(),this.currentPage=1,this.updatePagination()}sortGameRooms(){let i="1969-12-31T19:00:00";this.filteredGameRooms.sort((t,e)=>{if(this.sortField==="code"){let a=t.code.toLowerCase(),l=e.code.toLowerCase();return this.sortDirection==="asc"?a.localeCompare(l):l.localeCompare(a)}else if(this.sortField==="createdAt"){let a=t.created_at||t.createdAt||i,l=e.created_at||e.createdAt||i;(!a||!l)&&console.warn("Using default date for missing field:",{a:t,b:e});let h=new Date(a).getTime(),g=new Date(l).getTime();return isNaN(h)||isNaN(g)?(console.error("Invalid date format, using default:",{dateA:h,dateB:g}),0):this.sortDirection==="asc"?h-g:g-h}else if(this.sortField==="expirationAt"){let a=t.expiration_date||t.expirationAt||i,l=e.expiration_date||e.expirationAt||i;if(!a||!l)return console.warn("Missing date field:",{a:t,b:e}),0;let h=new Date(a).getTime(),g=new Date(l).getTime();return this.sortDirection==="asc"?h-g:g-h}}),this.updatePagination()}toggleSort(i){this.sortField===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=i,this.sortDirection="asc"),this.sortGameRooms(),this.updatePagination()}static \u0275fac=function(t){return new(t||r)(y(Z),y(J),y(K),y(Q))};static \u0275cmp=k({type:r,selectors:[["app-report"]],standalone:!0,features:[M],decls:60,vars:53,consts:[[1,"mb-6","p-4","bg-white","rounded-lg","shadow-md"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"relative","flex-1"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text",1,"w-full","pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition","duration-150","ease-in-out",3,"ngModelChange","input","ngModel","placeholder"],[1,"flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","px-4","py-2","bg-white","border","border-gray-300","rounded-lg","text-sm","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","transition","duration-150","ease-in-out",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"ml-2","h-5","w-5",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2",4,"ngIf"],[1,"py-5"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","table-auto"],[1,"bg-[#0D92F4]","text-white"],[1,"px-4","py-3","text-left","text-sm","font-medium","uppercase","tracking-wider","whitespace-nowrap"],["class","odd:bg-gray-50 even:bg-gray-100 hover:bg-gray-200",4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","mt-6","space-x-2"],[1,"px-4","py-2","text-sm","font-medium","text-gray-500","bg-gray-100","border","border-gray-300","rounded-md","hover:bg-gray-200","hover:text-gray-700","transition-colors","duration-300",3,"click","disabled","ngClass"],["class","px-4 py-2 text-sm font-medium border rounded-md transition-colors duration-300",3,"ngClass","click",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"odd:bg-gray-50","even:bg-gray-100","hover:bg-gray-200"],[1,"px-4","py-4","text-sm","text-gray-700","whitespace-nowrap"],[1,"flex","gap-2"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#28A745]","rounded","hover:bg-green-700","focus:outline-none",3,"click"],[1,"px-4","py-2","text-sm","font-medium","border","rounded-md","transition-colors","duration-300",3,"click","ngClass"]],template:function(t,e){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u(),o(4,"svg",4),v(5,"path",5),s()(),b(),o(6,"input",6),c(7,"translate"),B("ngModelChange",function(l){return F(e.searchTerm,l)||(e.searchTerm=l),l}),_("input",function(){return e.searchGameRooms()}),s()(),o(8,"div",7)(9,"button",8),_("click",function(){return e.toggleSort("code")}),o(10,"span"),d(11),c(12,"translate"),s(),u(),o(13,"svg",9),S(14,ee,1,0,"path",10)(15,te,1,1,"path",11),s()(),b(),o(16,"button",8),_("click",function(){return e.toggleSort("expirationAt")}),o(17,"span"),d(18),c(19,"translate"),s(),u(),o(20,"svg",9),S(21,ie,1,0,"path",10)(22,ne,1,1,"path",11),s()(),b(),o(23,"button",8),_("click",function(){return e.toggleSort("createdAt")}),o(24,"span"),d(25),c(26,"translate"),s(),u(),o(27,"svg",9),S(28,oe,1,0,"path",10)(29,re,1,1,"path",11),s()()()()(),b(),o(30,"div",12)(31,"div",13)(32,"div",14)(33,"table",15)(34,"thead",16)(35,"tr")(36,"th",17),d(37," Id"),s(),o(38,"th",17),d(39),c(40,"translate"),s(),o(41,"th",17),d(42),c(43,"translate"),s(),o(44,"th",17),d(45),c(46,"translate"),s(),o(47,"th",17),d(48),c(49,"translate"),s()()(),o(50,"tbody"),S(51,ae,14,7,"tr",18),s()()()(),o(52,"div",19)(53,"button",20),_("click",function(){return e.prevPage()}),d(54),c(55,"translate"),s(),S(56,se,2,2,"button",21),o(57,"button",20),_("click",function(){return e.nextPage()}),d(58),c(59,"translate"),s()()()),t&2&&(n(6),G("placeholder",m(7,26,"GAME_ROOM.SEARCH_PLACEHOLDER")),O("ngModel",e.searchTerm),n(5),R(m(12,28,"GAME_ROOM.SORT_BY_CODE")),n(2),p("ngClass",C(46,I,e.sortField==="code"&&e.sortDirection==="desc")),n(),p("ngIf",e.sortField!=="code"),n(),p("ngIf",e.sortField==="code"),n(3),R(m(19,30,"GAME_ROOM.SORT_BY_EXPIRATION")),n(2),p("ngClass",C(48,I,e.sortField==="expirationAt"&&e.sortDirection==="desc")),n(),p("ngIf",e.sortField!=="expirationAt"),n(),p("ngIf",e.sortField==="expirationAt"),n(3),R(m(26,32,"GAME_ROOM.SORT_BY_DATE")),n(2),p("ngClass",C(50,I,e.sortField==="createdAt"&&e.sortDirection==="desc")),n(),p("ngIf",e.sortField!=="createdAt"),n(),p("ngIf",e.sortField==="createdAt"),n(10),f(" ",m(40,34,"TABLE.CODE"),""),n(3),f(" ",m(43,36,"TABLE.CREATION_DATE"),""),n(3),f(" ",m(46,38,"TABLE.EXPIRATION_DATE"),""),n(3),f(" ",m(49,40,"TABLE.ACTIONS"),""),n(3),p("ngForOf",e.paginatedData),n(2),p("disabled",e.currentPage===1)("ngClass",e.currentPage===1?"opacity-50 cursor-not-allowed":""),n(),f(" \xAB ",m(55,42,"BUTTON_NAVIGATION_TABLE.PREVIOUS")," "),n(2),p("ngForOf",L(52,$).constructor(e.totalPages)),n(),p("disabled",e.currentPage===e.totalPages)("ngClass",e.currentPage===e.totalPages?"opacity-50 cursor-not-allowed":""),n(),f(" ",m(59,44,"BUTTON_NAVIGATION_TABLE.NEXT")," \xBB "))},dependencies:[U,N,V,j,q,z,Y,H,W,X]})};export{P as default};
