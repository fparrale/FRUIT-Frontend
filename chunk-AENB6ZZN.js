import{a as Z,b as ee,c as me}from"./chunk-XMJ5Y64K.js";import{a as te}from"./chunk-XDRR6Q6Q.js";import{a as X,b as q,e as Q,q as Y}from"./chunk-LMQWO4W5.js";import{a as K}from"./chunk-QMIFJZ5Y.js";import{a as z,b as J}from"./chunk-JTD2GUQY.js";import"./chunk-HUXOVQR6.js";import{c as W,d as $}from"./chunk-JOV6O4AC.js";import{l as H}from"./chunk-24SHYF34.js";import{Ab as l,Ac as U,Bb as R,Cb as p,Fb as k,Gb as L,Hb as D,Jb as B,Kb as F,Lb as G,Qa as n,Qb as d,Ra as S,Rb as c,bb as E,db as T,e as le,eb as g,ia as O,ib as o,jb as r,kb as _,nb as A,pb as u,ra as b,rb as h,sa as y,ta as f,tc as N,ua as C,ub as M,uc as V,vc as j}from"./chunk-NJXLY5TY.js";var ne=le(me());var ie=m=>({"transform rotate-180":m}),de=()=>[];function ce(m,i){m&1&&(f(),_(0,"path",31))}function pe(m,i){if(m&1&&(f(),_(0,"path",32)),m&2){let e=h();T("d",e.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function ge(m,i){m&1&&(f(),_(0,"path",31))}function ue(m,i){if(m&1&&(f(),_(0,"path",32)),m&2){let e=h();T("d",e.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function he(m,i){if(m&1){let e=A();o(0,"tr",33)(1,"td",34),l(2),r(),o(3,"td",34),l(4),r(),o(5,"td",34),l(6),r(),o(7,"td",34),l(8),r(),o(9,"td",34)(10,"span",35),_(11,"span",36),l(12),d(13,"translate"),d(14,"translate"),r()(),o(15,"td",34)(16,"div",37)(17,"button",38),u("click",function(){let s=b(e).$implicit,a=h();return y(a.onEdit(s))}),l(18),d(19,"translate"),r(),o(20,"button",39),u("click",function(){let s=b(e).$implicit,a=h();return y(a.onDelete(s))}),l(21),d(22,"translate"),r(),o(23,"button",40),u("click",function(){let s=b(e).$implicit,a=h();return y(a.onHistoryPlayers(s.id))}),l(24),d(25,"translate"),r()()()()}if(m&2){let e=i.$implicit,t=h();n(2),R(e.id),n(2),R(e.code),n(2),p("",t.formatDate(e.created_at)," "),n(2),p("",t.formatDate(e.expiration_date)," "),n(2),g("ngClass",e.status?"bg-green-100 text-green-800 border-green-300":"bg-red-100 text-red-800 border-red-300"),n(),g("ngClass",e.status?"bg-green-500":"bg-red-500"),n(),p(" ",e.status?c(13,10,"GAME_ROOM.ASSET"):c(14,12,"GAME_ROOM.IDLE")," "),n(6),p(" ",c(19,14,"CREATE_GAME_ROOM.MODAL_EDIT_CREATE_RNF.BUTTON_EDIT_MODAL")," "),n(3),p(" ",c(22,16,"GAME_ROOM.ELIMINATED")," "),n(3),p(" ",c(25,18,"GAME_ROOM.PLAYER_HISTORY")," ")}}function fe(m,i){if(m&1){let e=A();o(0,"button",41),u("click",function(){let s=b(e).index,a=h();return y(a.goToPage(s+1))}),l(1),r()}if(m&2){let e=i.index,t=h();g("ngClass",t.currentPage===e+1?"bg-[#0D92F4] text-white border-blue-500":"bg-gray-100 text-gray-500 border-gray-300 hover:bg-gray-200 hover:text-gray-700"),n(),p(" ",e+1," ")}}var I=class m{constructor(i,e,t,s,a){this.gameRoomsService=i;this.alertService=e;this.loadingService=t;this.router=s;this.storageService=a}gameRooms=[];paginatedData=[];currentPage=1;itemsPerPage=5;selectedFile=null;questions=[];listRnf=[];searchTerm="";sortDirection="asc";sortField="code";filteredGameRooms=[];ngOnInit(){this.getGameRooms()}getGameRooms(){this.loadingService.showLoading(),this.gameRoomsService.getGameRooms().subscribe({next:i=>{this.loadingService.hideLoading(),this.gameRooms=i.data,this.filteredGameRooms=[...this.gameRooms],this.updatePagination()},error:i=>{this.loadingService.hideLoading(),this.alertService.showAlert(i.message,!0)}})}onDelete(i){let e=!1;i.status==!0?e=!1:e=!0,this.loadingService.showLoading(),this.gameRoomsService.deleteGameRoom(i.id,e,this.storageService.getItem()||"es").subscribe({next:t=>{this.loadingService.hideLoading(),this.alertService.showAlert(t.message,!1),this.getGameRooms()},error:t=>{this.loadingService.hideLoading(),this.alertService.showAlert(t.message,!0)}})}onEdit(i){this.loadingService.showLoading(),this.gameRoomsService.getGameRoomQuestions(i.id).subscribe({next:e=>{this.loadingService.hideLoading(),this.questions=e.questions,this.router.navigate(["/edit-game-room",i.id],{state:{questions:this.questions,gameRoom:i}})},error:e=>{this.loadingService.hideLoading(),this.alertService.showAlert(e.message,!0)}})}transformExcelToCsv(i){return new Promise((e,t)=>{let s=new FileReader;s.onload=a=>{let v=new Uint8Array(a.target.result),x=new Array;for(let w=0;w!==v.length;++w)x[w]=String.fromCharCode(v[w]);let oe=x.join(""),P=Z(oe,{type:"binary"}),re=P.SheetNames[0],ae=P.Sheets[re],se=ee.sheet_to_csv(ae);e(se)},s.onerror=a=>t(a),s.readAsArrayBuffer(i)})}parseCsvToArray(i){ne.parse(i,{header:!0,skipEmptyLines:!0,complete:e=>{this.listRnf=e.data,this.gameRoomsService.uploadExcel(this.listRnf).subscribe({next:t=>{this.loadingService.hideLoading(),this.alertService.showAlert(t.message,!1),this.getGameRooms()},error:t=>{this.loadingService.hideLoading(),this.alertService.showAlert("Error al subir el archivo",!0),console.error("Error al subir archivo:",t)}})},error:e=>{console.error("Error parsing CSV:",e)}})}onFileSelected(i){let e=i.target;if(e.files&&e.files.length>0){let t=e.files[0];if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(t.type)){this.alertService.showAlert("Solo se permiten archivos Excel (.xls, .xlsx)",!0),e.value="";return}this.loadingService.showLoading(),this.transformExcelToCsv(t).then(a=>{this.parseCsvToArray(a),this.loadingService.hideLoading(),e.value=""}).catch(a=>{e.value="",this.loadingService.hideLoading(),this.alertService.showAlert("Error al subir el archivo",a)})}}updatePagination(){let i=(this.currentPage-1)*this.itemsPerPage,e=i+this.itemsPerPage;this.paginatedData=this.filteredGameRooms.slice(i,e)}goToPage(i){this.currentPage=i,this.updatePagination()}nextPage(){this.currentPage*this.itemsPerPage<this.gameRooms.length&&(this.currentPage++,this.updatePagination())}prevPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}get totalPages(){return Math.ceil(this.filteredGameRooms.length/this.itemsPerPage)}formatDate(i){let e=new Date(i),t={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"};return e.toLocaleDateString("es-ES",t).replace(",","")}goToCreateGameRoom(){this.router.navigate(["/create-game-room"])}searchGameRooms(){this.filteredGameRooms=this.gameRooms.filter(i=>i.code.toLowerCase().includes(this.searchTerm.toLowerCase())),this.sortGameRooms(),this.currentPage=1,this.updatePagination()}sortGameRooms(){let i="1969-12-31T19:00:00";this.filteredGameRooms.sort((e,t)=>{if(this.sortField==="code"){let s=e.code.toLowerCase(),a=t.code.toLowerCase();return this.sortDirection==="asc"?s.localeCompare(a):a.localeCompare(s)}else{let s=e.created_at||e.createdAt||i,a=t.created_at||t.createdAt||i;(!s||!a)&&console.warn("Using default date for missing field:",{a:e,b:t});let v=new Date(s).getTime(),x=new Date(a).getTime();return isNaN(v)||isNaN(x)?(console.error("Invalid date format, using default:",{dateA:v,dateB:x}),0):this.sortDirection==="asc"?v-x:x-v}}),this.updatePagination()}toggleSort(i){this.sortField===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=i,this.sortDirection="asc"),this.sortGameRooms(),this.updatePagination()}onHistoryPlayers(i){this.router.navigate(["/get-participating-players",i])}static \u0275fac=function(e){return new(e||m)(S(te),S(z),S(J),S(H),S(K))};static \u0275cmp=O({type:m,selectors:[["app-game-rooms"]],standalone:!0,features:[B],decls:73,vars:57,consts:[[1,"py-5"],[1,"flex","flex-wrap","gap-4","mb-6","items-center","justify-between"],[1,"flex","items-center","gap-2","px-4","py-2","text-white","bg-[#28A745]","rounded-lg","shadow-md","hover:bg-green-700","focus:outline-none","transition","duration-300","w-full","sm:w-auto","text-center","justify-center",3,"click"],[1,"material-icons","text-base"],[1,"flex","flex-col","sm:flex-row","items-center","gap-4","w-full","sm:w-auto"],[1,"flex","items-center","gap-2"],["for","fileInput",1,"text-sm","font-medium","text-gray-700"],["id","fileInput","type","file","accept",".xlsx, .xls",1,"w-auto","px-3","py-2","text-sm","border","border-gray-300","rounded-lg","shadow-sm","focus:ring-blue-500","focus:border-blue-500","transition","duration-300","cursor-pointer",3,"change"],["href","https://franklinparrales.es/RECURSOS/FRUIT-example.xlsx","download","example.xlsx",1,"flex","items-center","bg-green-500","text-white","font-medium","px-4","py-2","rounded-lg","shadow-md","hover:bg-green-600","transition","duration-300"],[1,"material-icons","pr-1"],[1,"mb-6","p-4","bg-white","rounded-lg","shadow-md"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"relative","flex-1"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text",1,"w-full","pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition","duration-150","ease-in-out",3,"ngModelChange","input","ngModel","placeholder"],[1,"flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","px-4","py-2","bg-white","border","border-gray-300","rounded-lg","text-sm","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","transition","duration-150","ease-in-out",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"ml-2","h-5","w-5",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2",4,"ngIf"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","table-auto"],[1,"bg-[#0D92F4]","text-white"],[1,"px-4","py-3","text-left","text-sm","font-medium","uppercase","tracking-wider","whitespace-nowrap"],["class","odd:bg-gray-50 even:bg-gray-100 hover:bg-gray-200",4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","mt-6","space-x-2"],[1,"px-4","py-2","text-sm","font-medium","text-gray-500","bg-gray-100","border","border-gray-300","rounded-md","hover:bg-gray-200","hover:text-gray-700","transition-colors","duration-300",3,"click","disabled","ngClass"],["class","px-4 py-2 text-sm font-medium border rounded-md transition-colors duration-300",3,"ngClass","click",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"odd:bg-gray-50","even:bg-gray-100","hover:bg-gray-200"],[1,"px-4","py-4","text-sm","text-gray-700","whitespace-nowrap"],[1,"inline-flex","items-center","gap-2","px-3","py-1","text-xs","font-medium","border","rounded-full",3,"ngClass"],[1,"w-2.5","h-2.5","rounded-full",3,"ngClass"],[1,"flex","gap-2"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#0D92F4]","rounded","hover:bg-blue-700","focus:outline-none",3,"click"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#C62E2E]","rounded","hover:bg-red-700","focus:outline-none",3,"click"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#6C757D]","rounded","hover:bg-[#6C757D]","focus:outline-none",3,"click"],[1,"px-4","py-2","text-sm","font-medium","border","rounded-md","transition-colors","duration-300",3,"click","ngClass"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),u("click",function(){return t.goToCreateGameRoom()}),o(3,"span",3),l(4,"add"),r(),l(5),d(6,"translate"),r(),o(7,"div",4)(8,"div",5)(9,"label",6),l(10),d(11,"translate"),r(),o(12,"input",7),u("change",function(a){return t.onFileSelected(a)}),r()(),o(13,"a",8)(14,"span",9),l(15,"download"),r(),l(16),d(17,"translate"),r()()(),o(18,"div",10)(19,"div",11)(20,"div",12)(21,"div",13),f(),o(22,"svg",14),_(23,"path",15),r()(),C(),o(24,"input",16),d(25,"translate"),D("ngModelChange",function(a){return L(t.searchTerm,a)||(t.searchTerm=a),a}),u("input",function(){return t.searchGameRooms()}),r()(),o(26,"div",17)(27,"button",18),u("click",function(){return t.toggleSort("code")}),o(28,"span"),l(29),d(30,"translate"),r(),f(),o(31,"svg",19),E(32,ce,1,0,"path",20)(33,pe,1,1,"path",21),r()(),C(),o(34,"button",18),u("click",function(){return t.toggleSort("createdAt")}),o(35,"span"),l(36),d(37,"translate"),r(),f(),o(38,"svg",19),E(39,ge,1,0,"path",20)(40,ue,1,1,"path",21),r()()()()(),C(),o(41,"div",22)(42,"div",23)(43,"table",24)(44,"thead",25)(45,"tr")(46,"th",26),l(47," Id"),r(),o(48,"th",26),l(49),d(50,"translate"),r(),o(51,"th",26),l(52),d(53,"translate"),r(),o(54,"th",26),l(55),d(56,"translate"),r(),o(57,"th",26),l(58),d(59,"translate"),r(),o(60,"th",26),l(61),d(62,"translate"),r()()(),o(63,"tbody"),E(64,he,26,20,"tr",27),r()()()(),o(65,"div",28)(66,"button",29),u("click",function(){return t.prevPage()}),l(67),d(68,"translate"),r(),E(69,fe,2,2,"button",30),o(70,"button",29),u("click",function(){return t.nextPage()}),l(71),d(72,"translate"),r()()()),e&2&&(n(5),p(" ",c(6,26,"GAME_ROOM.BUTTON_CREATE")," "),n(5),p(" ",c(11,28,"GAME_ROOM.UPLOAD_QUESTION")," "),n(6),p(" ",c(17,30,"GAME_ROOM.EXCEL_FILE")," "),n(8),M("placeholder",c(25,32,"GAME_ROOM.SEARCH_PLACEHOLDER")),k("ngModel",t.searchTerm),n(5),R(c(30,34,"GAME_ROOM.SORT_BY_CODE")),n(2),g("ngClass",G(52,ie,t.sortField==="code"&&t.sortDirection==="desc")),n(),g("ngIf",t.sortField!=="code"),n(),g("ngIf",t.sortField==="code"),n(3),R(c(37,36,"GAME_ROOM.SORT_BY_DATE")),n(2),g("ngClass",G(54,ie,t.sortField==="createdAt"&&t.sortDirection==="desc")),n(),g("ngIf",t.sortField!=="createdAt"),n(),g("ngIf",t.sortField==="createdAt"),n(9),p(" ",c(50,38,"TABLE.CODE"),""),n(3),p(" ",c(53,40,"TABLE.CREATION_DATE"),""),n(3),p(" ",c(56,42,"TABLE.EXPIRATION_DATE"),""),n(3),p(" ",c(59,44,"TABLE.STATUS"),""),n(3),p(" ",c(62,46,"TABLE.ACTIONS"),""),n(3),g("ngForOf",t.paginatedData),n(2),g("disabled",t.currentPage===1)("ngClass",t.currentPage===1?"opacity-50 cursor-not-allowed":""),n(),p(" \xAB ",c(68,48,"BUTTON_NAVIGATION_TABLE.PREVIOUS")," "),n(2),g("ngForOf",F(56,de).constructor(t.totalPages)),n(),g("disabled",t.currentPage===t.totalPages)("ngClass",t.currentPage===t.totalPages?"opacity-50 cursor-not-allowed":""),n(),p(" ",c(72,50,"BUTTON_NAVIGATION_TABLE.NEXT")," \xBB "))},dependencies:[U,N,V,j,$,W,Y,X,q,Q],styles:[".search-sort-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.search-box[_ngcontent-%COMP%]{flex:0 0 300px}.sort-buttons[_ngcontent-%COMP%]{display:flex;gap:10px}"]})};export{I as default};
