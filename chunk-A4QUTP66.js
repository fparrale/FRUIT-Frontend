import{a as Q}from"./chunk-LOADLFAF.js";import{a as U,b as H,e as W,q as X}from"./chunk-LMQWO4W5.js";import{a as K}from"./chunk-QMIFJZ5Y.js";import{a as q,b as J}from"./chunk-JTD2GUQY.js";import"./chunk-STFLDL63.js";import{c as Y,d as z}from"./chunk-JOV6O4AC.js";import"./chunk-24SHYF34.js";import{Ab as l,Ac as j,Bb as R,Cb as p,Fb as G,Gb as O,Hb as L,Jb as B,Kb as F,Lb as P,Qa as n,Qb as m,Ra as S,Rb as g,bb as b,db as T,eb as c,ia as k,ib as o,jb as r,kb as x,nb as E,pb as f,ra as w,rb as _,sa as C,ta as h,tc as M,ua as y,ub as D,uc as N,vc as V}from"./chunk-NJXLY5TY.js";var Z=a=>({"transform rotate-180":a}),$=()=>[];function ee(a,i){a&1&&(h(),x(0,"path",22))}function te(a,i){if(a&1&&(h(),x(0,"path",23)),a&2){let t=_();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function ie(a,i){a&1&&(h(),x(0,"path",22))}function ne(a,i){if(a&1&&(h(),x(0,"path",23)),a&2){let t=_();T("d",t.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function oe(a,i){if(a&1){let t=E();o(0,"tr",24)(1,"td",25),l(2),r(),o(3,"td",25),l(4),r(),o(5,"td",25),l(6),r(),o(7,"td",25),l(8),r(),o(9,"td",25)(10,"div",26)(11,"button",27),f("click",function(){let s=w(t).$implicit,d=_();return C(d.onGenerateReportGameRoom(s))}),l(12),m(13,"translate"),r()()()()}if(a&2){let t=i.$implicit,e=_();n(2),R(t.id),n(2),R(t.code),n(2),p("",e.formatDate(t.created_at)," "),n(2),p("",e.formatDate(t.expiration_date)," "),n(4),p(" ",g(13,5,"REPORT.GENERATE_REPORT")," ")}}function re(a,i){if(a&1){let t=E();o(0,"button",28),f("click",function(){let s=w(t).index,d=_();return C(d.goToPage(s+1))}),l(1),r()}if(a&2){let t=i.index,e=_();c("ngClass",e.currentPage===t+1?"bg-[#0D92F4] text-white border-blue-500":"bg-gray-100 text-gray-500 border-gray-300 hover:bg-gray-200 hover:text-gray-700"),n(),p(" ",t+1," ")}}var I=class a{constructor(i,t,e,s){this.gameRoomsService=i;this.alertService=t;this.loadingService=e;this.serviceStorage=s}gameRooms=[];paginatedData=[];currentPage=1;itemsPerPage=5;selectedFile=null;searchTerm="";sortDirection="asc";sortField="code";filteredGameRooms=[];ngOnInit(){this.getGameRooms()}getGameRooms(){this.loadingService.showLoading(),this.gameRoomsService.getGameRooms().subscribe({next:i=>{this.loadingService.hideLoading(),this.gameRooms=i.data,this.filteredGameRooms=[...this.gameRooms],this.updatePagination()},error:i=>{this.loadingService.hideLoading(),this.alertService.showAlert(i.message,!0)}})}onGenerateReportGameRoom(i){this.loadingService.showLoading(),this.gameRoomsService.generateReportGameRoom(i.id,this.serviceStorage.getItem()||"es").subscribe({next:t=>{let e=t.headers.get("Content-Disposition"),s="reporte.pdf";if(e){let A=e.match(/filename="(.+)"/);A&&(s=A[1])}let d=t.body,v=window.URL.createObjectURL(d),u=document.createElement("a");u.href=v,u.download=s,u.click(),window.URL.revokeObjectURL(v),this.loadingService.hideLoading()},error:t=>{this.loadingService.hideLoading(),this.alertService.showAlert(t.message,!0)}})}updatePagination(){let i=(this.currentPage-1)*this.itemsPerPage,t=i+this.itemsPerPage;this.paginatedData=this.filteredGameRooms.slice(i,t)}goToPage(i){this.currentPage=i,this.updatePagination()}nextPage(){this.currentPage*this.itemsPerPage<this.gameRooms.length&&(this.currentPage++,this.updatePagination())}prevPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}get totalPages(){return Math.ceil(this.filteredGameRooms.length/this.itemsPerPage)}formatDate(i){let t=new Date(i),e={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"};return t.toLocaleDateString("es-ES",e).replace(",","")}searchGameRooms(){this.filteredGameRooms=this.gameRooms.filter(i=>i.code.toLowerCase().includes(this.searchTerm.toLowerCase())),this.sortGameRooms(),this.currentPage=1,this.updatePagination()}sortGameRooms(){let i="1969-12-31T19:00:00";this.filteredGameRooms.sort((t,e)=>{if(this.sortField==="code"){let s=t.code.toLowerCase(),d=e.code.toLowerCase();return this.sortDirection==="asc"?s.localeCompare(d):d.localeCompare(s)}else{let s=t.created_at||t.createdAt||i,d=e.created_at||e.createdAt||i;(!s||!d)&&console.warn("Using default date for missing field:",{a:t,b:e});let v=new Date(s).getTime(),u=new Date(d).getTime();return isNaN(v)||isNaN(u)?(console.error("Invalid date format, using default:",{dateA:v,dateB:u}),0):this.sortDirection==="asc"?v-u:u-v}}),this.updatePagination()}toggleSort(i){this.sortField===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=i,this.sortDirection="asc"),this.sortGameRooms(),this.updatePagination()}static \u0275fac=function(t){return new(t||a)(S(Q),S(q),S(J),S(K))};static \u0275cmp=k({type:a,selectors:[["app-report"]],standalone:!0,features:[B],decls:53,vars:45,consts:[[1,"mb-6","p-4","bg-white","rounded-lg","shadow-md"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"relative","flex-1"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text",1,"w-full","pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition","duration-150","ease-in-out",3,"ngModelChange","input","ngModel","placeholder"],[1,"flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","px-4","py-2","bg-white","border","border-gray-300","rounded-lg","text-sm","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","transition","duration-150","ease-in-out",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"ml-2","h-5","w-5",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2",4,"ngIf"],[1,"py-5"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","table-auto"],[1,"bg-[#0D92F4]","text-white"],[1,"px-4","py-3","text-left","text-sm","font-medium","uppercase","tracking-wider","whitespace-nowrap"],["class","odd:bg-gray-50 even:bg-gray-100 hover:bg-gray-200",4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","mt-6","space-x-2"],[1,"px-4","py-2","text-sm","font-medium","text-gray-500","bg-gray-100","border","border-gray-300","rounded-md","hover:bg-gray-200","hover:text-gray-700","transition-colors","duration-300",3,"click","disabled","ngClass"],["class","px-4 py-2 text-sm font-medium border rounded-md transition-colors duration-300",3,"ngClass","click",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"odd:bg-gray-50","even:bg-gray-100","hover:bg-gray-200"],[1,"px-4","py-4","text-sm","text-gray-700","whitespace-nowrap"],[1,"flex","gap-2"],[1,"px-2","py-1","text-xs","font-medium","text-white","bg-[#28A745]","rounded","hover:bg-green-700","focus:outline-none",3,"click"],[1,"px-4","py-2","text-sm","font-medium","border","rounded-md","transition-colors","duration-300",3,"click","ngClass"]],template:function(t,e){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),h(),o(4,"svg",4),x(5,"path",5),r()(),y(),o(6,"input",6),m(7,"translate"),L("ngModelChange",function(d){return O(e.searchTerm,d)||(e.searchTerm=d),d}),f("input",function(){return e.searchGameRooms()}),r()(),o(8,"div",7)(9,"button",8),f("click",function(){return e.toggleSort("code")}),o(10,"span"),l(11),m(12,"translate"),r(),h(),o(13,"svg",9),b(14,ee,1,0,"path",10)(15,te,1,1,"path",11),r()(),y(),o(16,"button",8),f("click",function(){return e.toggleSort("createdAt")}),o(17,"span"),l(18),m(19,"translate"),r(),h(),o(20,"svg",9),b(21,ie,1,0,"path",10)(22,ne,1,1,"path",11),r()()()()(),y(),o(23,"div",12)(24,"div",13)(25,"div",14)(26,"table",15)(27,"thead",16)(28,"tr")(29,"th",17),l(30," Id"),r(),o(31,"th",17),l(32),m(33,"translate"),r(),o(34,"th",17),l(35),m(36,"translate"),r(),o(37,"th",17),l(38),m(39,"translate"),r(),o(40,"th",17),l(41),m(42,"translate"),r()()(),o(43,"tbody"),b(44,oe,14,7,"tr",18),r()()()(),o(45,"div",19)(46,"button",20),f("click",function(){return e.prevPage()}),l(47),m(48,"translate"),r(),b(49,re,2,2,"button",21),o(50,"button",20),f("click",function(){return e.nextPage()}),l(51),m(52,"translate"),r()()()),t&2&&(n(6),D("placeholder",g(7,22,"GAME_ROOM.SEARCH_PLACEHOLDER")),G("ngModel",e.searchTerm),n(5),R(g(12,24,"GAME_ROOM.SORT_BY_CODE")),n(2),c("ngClass",P(40,Z,e.sortField==="code"&&e.sortDirection==="desc")),n(),c("ngIf",e.sortField!=="code"),n(),c("ngIf",e.sortField==="code"),n(3),R(g(19,26,"GAME_ROOM.SORT_BY_DATE")),n(2),c("ngClass",P(42,Z,e.sortField==="createdAt"&&e.sortDirection==="desc")),n(),c("ngIf",e.sortField!=="createdAt"),n(),c("ngIf",e.sortField==="createdAt"),n(10),p(" ",g(33,28,"TABLE.CODE"),""),n(3),p(" ",g(36,30,"TABLE.CREATION_DATE"),""),n(3),p(" ",g(39,32,"TABLE.EXPIRATION_DATE"),""),n(3),p(" ",g(42,34,"TABLE.ACTIONS"),""),n(3),c("ngForOf",e.paginatedData),n(2),c("disabled",e.currentPage===1)("ngClass",e.currentPage===1?"opacity-50 cursor-not-allowed":""),n(),p(" \xAB ",g(48,36,"BUTTON_NAVIGATION_TABLE.PREVIOUS")," "),n(2),c("ngForOf",F(44,$).constructor(e.totalPages)),n(),c("disabled",e.currentPage===e.totalPages)("ngClass",e.currentPage===e.totalPages?"opacity-50 cursor-not-allowed":""),n(),p(" ",g(52,38,"BUTTON_NAVIGATION_TABLE.NEXT")," \xBB "))},dependencies:[j,M,N,V,z,Y,X,U,H,W]})};export{I as default};
