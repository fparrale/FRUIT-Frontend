import{a as d,b as g,l as h}from"./chunk-24SHYF34.js";import{G as o,X as n,_ as m,da as c,r as s}from"./chunk-NJXLY5TY.js";var i=class extends Error{};i.prototype.name="InvalidTokenError";function U(a){return decodeURIComponent(atob(a).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function v(a){let e=a.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return U(e)}catch{return atob(e)}}function f(a,e){if(typeof a!="string")throw new i("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,r=a.split(".")[t];if(typeof r!="string")throw new i(`Invalid token specified: missing part #${t+1}`);let l;try{l=v(r)}catch(u){throw new i(`Invalid token specified: invalid base64 for part #${t+1} (${u.message})`)}try{return JSON.parse(l)}catch(u){throw new i(`Invalid token specified: invalid json for part #${t+1} (${u.message})`)}}var p={production:!0,apiUrl:"http://s1035367379.onlinehome.us/fruit/api/"};var w=class a{constructor(e,t){this.http=e;this.router=t}apiUrlLogin=p.apiUrl+"auth/login";apiUrlRegister=p.apiUrl+"auth/register";apiUrlRoles=p.apiUrl+"auth/roles";apiUrlSendCode=p.apiUrl+"change-password/send-otp";apiUrlPasswordReset=p.apiUrl+"change-password/reset-otp";apiUrlUsers=p.apiUrl+"users/list";userDataKey="userData";login(e,t){return this.http.post(this.apiUrlLogin,{email:e.email,password:e.password,language:t}).pipe(n(r=>{this.setUserData(r.data)}),o(r=>s(()=>new Error(r.error.message||"Ocurrio un error intentalo mas tarde"))))}register(e,t){return e.username=e.email,e.role=Number(e.role),e.birth_date=this.formatDate(new Date),this.http.post(this.apiUrlRegister,{name:e.name,last_name:e.last_name,username:e.email,email:e.email,password:e.password,role:e.role,birth_date:e.birth_date,language:t}).pipe(n(r=>r),o(r=>s(()=>new Error(r.error.message||"Ocurrio un error intentalo mas tarde"))))}getRoles(){return this.http.get(this.apiUrlRoles).pipe(n(e=>e),o(e=>s(()=>new Error(e.error.message||"Ocurrio un error intentalo mas tarde"))))}passwordSendCode(e,t){return this.http.post(this.apiUrlSendCode,{email:e.email,language:t}).pipe(n(r=>r),o(r=>s(()=>new Error(r.error.message||"Ocurrio un error intentalo mas tarde"))))}passwordReset(e,t){return this.http.post(this.apiUrlPasswordReset,{email:e.email,otp:e.otp,password:e.password,password_confirmation:e.password_confirmation,language:t}).pipe(n(r=>r),o(r=>s(()=>new Error(r.error.message||"Ocurrio un error intentalo mas tarde"))))}setUserData(e){localStorage.setItem(this.userDataKey,JSON.stringify(e))}getUserData(){if(typeof window<"u"){let e=localStorage.getItem(this.userDataKey);return e?JSON.parse(e):null}else return null}isAuthenticated(){let e=this.getUserData();return e?this.isValidToken(e):!1}isValidToken(e){try{let t=f(e.access_token),r=Math.floor(Date.now()/1e3);return t.exp>r}catch{return!1}}logout(){localStorage.removeItem(this.userDataKey),localStorage.removeItem("timer"),this.router.navigate(["/login"])}formatDate(e){let t=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),l=e.getDate().toString().padStart(2,"0");return`${t}-${r}-${l}`}getUsers(){let e=this.getUserData(),t=new d({Authorization:`Bearer ${e?.access_token}`});return this.http.get(this.apiUrlUsers,{headers:t}).pipe(n(r=>r),o(r=>s(()=>new Error(r.error.message||"Ocurrio un error intentalo mas tarde"))))}static \u0275fac=function(t){return new(t||a)(c(g),c(h))};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{p as a,w as b};
