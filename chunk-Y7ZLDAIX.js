import{a as Z,b as ee,e as te,q as ie}from"./chunk-LMQWO4W5.js";import{a as oe,b as ae}from"./chunk-JTD2GUQY.js";import{a as X,b as J}from"./chunk-EOS4WQRA.js";import{c as ne,d as re}from"./chunk-JOV6O4AC.js";import{a as Q,b as Y}from"./chunk-24SHYF34.js";import{Ab as s,Ac as q,Bb as g,Cb as u,Fb as L,G as M,Gb as V,Hb as U,Jb as j,Kb as $,Lb as P,Qa as t,Qb as p,Ra as T,Rb as c,X as D,_ as N,bb as _,da as H,db as B,eb as l,ia as R,ib as o,jb as r,kb as b,nb as A,pb as v,r as k,ra as I,rb as f,sa as C,ta as y,tc as W,ua as w,ub as F,uc as z,vc as K}from"./chunk-NJXLY5TY.js";var G=class i{constructor(n,e){this.http=n;this.authService=e}apiUrl=X.apiUrl+"game/game-history";getGameHistory(){let n=this.authService.getUserData(),e=new Q({Authorization:`Bearer ${n?.access_token}`});return this.http.get(this.apiUrl,{headers:e}).pipe(D(a=>a),M(a=>k(()=>new Error(a.error.message||"Ocurrio un error intentalo mas tarde"))))}static \u0275fac=function(e){return new(e||i)(H(Y),H(J))};static \u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})};var se=i=>({"transform rotate-180":i}),pe=()=>[];function ce(i,n){i&1&&(y(),b(0,"path",23))}function me(i,n){if(i&1&&(y(),b(0,"path",24)),i&2){let e=f();B("d",e.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function ge(i,n){i&1&&(y(),b(0,"path",23))}function ue(i,n){if(i&1&&(y(),b(0,"path",24)),i&2){let e=f();B("d",e.sortDirection==="asc"?"M8 9l4-4 4 4":"M8 15l4 4 4-4")}}function _e(i,n){i&1&&(o(0,"span",43),s(1,"\u2714"),r())}function fe(i,n){i&1&&(o(0,"span",44),s(1,"\u2718"),r())}function xe(i,n){if(i&1&&(o(0,"p",45)(1,"strong"),s(2),p(3,"translate"),r(),s(4),p(5,"translate"),r()),i&2){let e=f().$implicit;t(2),g(c(3,2,"RESULTS.FEEDBACK")),t(2),u(" ",e.feedback_variable||c(5,4,"NO_FEEDBACK")," ")}}function ve(i,n){i&1&&(o(0,"span",43),s(1,"\u2714"),r())}function he(i,n){i&1&&(o(0,"span",44),s(1,"\u2718"),r())}function ye(i,n){if(i&1&&(o(0,"p",45)(1,"strong"),s(2),p(3,"translate"),r(),s(4),p(5,"translate"),r()),i&2){let e=f().$implicit;t(2),g(c(3,2,"RESULTS.FEEDBACK")),t(2),u(" ",e.feedback_value||c(5,4,"NO_FEEDBACK")," ")}}function be(i,n){i&1&&(o(0,"span",43),s(1,"\u2714"),r())}function Se(i,n){i&1&&(o(0,"span",44),s(1,"\u2718"),r())}function Ie(i,n){if(i&1&&(o(0,"p",45)(1,"strong"),s(2),p(3,"translate"),r(),s(4),p(5,"translate"),r()),i&2){let e=f().$implicit;t(2),g(c(3,2,"RESULTS.FEEDBACK")),t(2),u(" ",e.feedback_recomend||c(5,4,"NO_FEEDBACK")," ")}}function Ce(i,n){i&1&&b(0,"hr",46)}function Ee(i,n){if(i&1&&(o(0,"li",35)(1,"p")(2,"strong",36),s(3),p(4,"translate"),r(),s(5),r(),o(6,"div",37)(7,"strong",36),s(8),p(9,"translate"),r(),o(10,"span",38),s(11),r(),o(12,"span"),_(13,_e,2,0,"span",39)(14,fe,2,0,"span",40),r()(),_(15,xe,6,6,"p",41),o(16,"div",37)(17,"strong",36),s(18),p(19,"translate"),r(),o(20,"span",38),s(21),r(),o(22,"span"),_(23,ve,2,0,"span",39)(24,he,2,0,"span",40),r()(),_(25,ye,6,6,"p",41),o(26,"div",37)(27,"strong",36),s(28),p(29,"translate"),r(),o(30,"span",38),s(31),r(),o(32,"span"),_(33,be,2,0,"span",39)(34,Se,2,0,"span",40),r()(),_(35,Ie,6,6,"p",41)(36,Ce,1,0,"hr",42),r()),i&2){let e=n.$implicit,a=n.last;t(3),u("",c(4,18,"QUESTION.NFR"),":"),t(2),u(" ",e.nfr," "),t(3),g(c(9,20,"MODAL_CONFIRMATION.LINGUISTIC_VARIABLE")),t(3),u("(",e.user_variable,")"),t(2),l("ngIf",e.correct_variable),t(),l("ngIf",!e.correct_variable),t(),l("ngIf",!e.correct_variable),t(3),g(c(19,22,"MODAL_CONFIRMATION.LINGUISTIC_VALUE")),t(3),u("(",e.user_value,")"),t(2),l("ngIf",e.correct_value),t(),l("ngIf",!e.correct_value),t(),l("ngIf",!e.correct_value),t(3),g(c(29,24,"MODAL_CONFIRMATION.LINGUISTIC_RECOMMENDATION")),t(3),u("(",e.user_recomend,")"),t(2),l("ngIf",e.correct_recomend),t(),l("ngIf",!e.correct_recomend),t(),l("ngIf",!e.correct_recomend),t(),l("ngIf",!a)}}function we(i,n){if(i&1){let e=A();o(0,"div",25)(1,"div",26)(2,"div",27)(3,"h3",28),s(4),p(5,"translate"),r()(),o(6,"div",29)(7,"ul",30),_(8,Ee,37,26,"li",31),r()(),o(9,"div",32)(10,"button",33),v("click",function(){I(e);let d=f();return C(d.closeModal())}),s(11),p(12,"translate"),r(),o(13,"button",34),v("click",function(){I(e);let d=f();return C(d.printResults())}),s(14),p(15,"translate"),r()()()()}if(i&2){let e=f();t(4),g(c(5,4,"TABLE.ANSWERS")),t(4),l("ngForOf",e.selectedAnswers),t(3),u(" ",c(12,6,"ALERT.BUTTON_CLOSE")," "),t(3),u(" ",c(15,8,"ALERT.PRINT")," ")}}function Te(i,n){if(i&1){let e=A();o(0,"tr",47)(1,"td",48),s(2),r(),o(3,"td",48),s(4),r(),o(5,"td",49),s(6),r(),o(7,"td",48),s(8),r(),o(9,"td",48)(10,"button",50),v("click",function(){let d=I(e).$implicit,m=f();return C(m.openAnswersModal(d.answered_questions,d))}),s(11),p(12,"translate"),r()()()}if(i&2){let e=n.$implicit;t(2),g(e.id),t(2),g(e.game_room.code),t(),l("ngClass",e.score>=70?"text-green-500":"text-red-500"),t(),u(" ",e.score," / 100 "),t(2),g(e.duration),t(3),u(" ",c(12,6,"TABLE.VIEW_ANSWERS")," ")}}function Ae(i,n){if(i&1){let e=A();o(0,"button",51),v("click",function(){let d=I(e).index,m=f();return C(m.goToPage(d+1))}),s(1),r()}if(i&2){let e=n.index,a=f();l("ngClass",a.currentPage===e+1?"bg-[#0D92F4] text-white border-blue-500":"bg-gray-100 text-gray-500 border-gray-300 hover:bg-gray-200 hover:text-gray-700"),t(),u(" ",e+1," ")}}var O=class i{constructor(n,e,a){this.gameHistoryService=n;this.alertService=e;this.loadingService=a}gameHistory=[];paginatedData=[];currentPage=1;itemsPerPage=5;searchTerm="";sortDirection="asc";sortField="code";filteredGameRooms=[];showModal=!1;selectedAnswers=[];gameHistoryPrint={};ngOnInit(){this.getGameHistory()}getGameHistory(){this.loadingService.showLoading(),this.gameHistoryService.getGameHistory().subscribe({next:n=>{this.loadingService.hideLoading(),this.gameHistory=n.data,this.filteredGameRooms=[...this.gameHistory],this.updatePagination()},error:n=>{this.loadingService.hideLoading(),this.alertService.showAlert(n.message,!0)}})}updatePagination(){let n=(this.currentPage-1)*this.itemsPerPage,e=n+this.itemsPerPage;this.paginatedData=this.filteredGameRooms.slice(n,e)}goToPage(n){this.currentPage=n,this.updatePagination()}nextPage(){this.currentPage*this.itemsPerPage<this.gameHistory.length&&(this.currentPage++,this.updatePagination())}prevPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}get totalPages(){return Math.ceil(this.filteredGameRooms.length/this.itemsPerPage)}searchGameRooms(){this.filteredGameRooms=this.gameHistory.filter(n=>(n.game_room?.code||n.game_room.code||"").toLowerCase().includes(this.searchTerm.toLowerCase())),this.sortGameRooms(),this.currentPage=1,this.updatePagination()}sortGameRooms(){let n="1969-12-31T19:00:00";this.filteredGameRooms.sort((e,a)=>{if(this.sortField==="code"){let d=(e.game_room?.code||e.code||"").toLowerCase(),m=(a.game_room?.code||a.code||"").toLowerCase();return this.sortDirection==="asc"?d.localeCompare(m):m.localeCompare(d)}else{let d=e.created_at||e.createdAt||n,m=a.created_at||a.createdAt||n;(!d||!m)&&console.warn("Using default date for missing field:",{a:e,b:a});let S=new Date(d).getTime(),h=new Date(m).getTime();return isNaN(S)||isNaN(h)?(console.error("Invalid date format, using default:",{dateA:S,dateB:h}),0):this.sortDirection==="asc"?S-h:h-S}}),this.updatePagination()}toggleSort(n){this.sortField===n?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=n,this.sortDirection="asc"),this.sortGameRooms(),this.updatePagination()}openAnswersModal(n,e){this.selectedAnswers=n,this.gameHistoryPrint=e,this.showModal=!0}closeModal(){this.showModal=!1,this.selectedAnswers=[],this.gameHistoryPrint={}}printResults(){let n=document.getElementById("print-content"),e=this.gameHistoryPrint,a=e.score,d=e.user.names,m=e.user.surnames,S=e.duration,h=e.game_room.code;if(n){document.title=`Resultados - ${m} ${d} - ${h}`;let x=document.createElement("iframe");x.style.position="absolute",x.style.width="0",x.style.height="0",x.style.border="none",document.body.appendChild(x);let E=x.contentWindow?.document||x.contentDocument;E&&(E.open(),E.write(`
          <html>
            <head>
            <title>Resultados - ${m} ${d} - ${h}</title>
              <style>
                body {
                  font-family: Arial, sans-serif;
                  margin: 20px;
                  color: #4a5568;
                }
                .header {
                  margin-bottom: 20px;
                  border-bottom: 1px solid #e2e8f0;
                  position: relative;
                }
                .score-box {
                  position: absolute;
                  top: 0;
                  right: 10px;
                  padding: 10px;
                  border: 2px solid #4a5568;
                  font-weight: bold;
                  font-size: 16px;
                  text-align: center;
                  color: #4a5568;
                  background-color: #f1f5f9;
                }
                .font-bold {
                  font-weight: bold;
                }
                .text-gray-700 {
                  color: #4a5568;
                }
                .text-green-500 {
                  color: #48bb78;
                }
                .text-red-500 {
                  color: #f56565;
                }
                .text-sm {
                  font-size: 0.875rem;
                }
              </style>
            </head>
            <body>
              <div class="header">
                <div class="score-box">
                  SCORE<br>${a} / 100
                </div>
                <h2 class="font-bold text-gray-700">Resultado</h2>
                <p><strong>Nombres:</strong> ${d}</p>
                <p><strong>Apellidos:</strong> ${m}</p>
                <p><strong>Duraci\xF3n:</strong> ${S}</p>
                <p><strong>C\xF3digo de sala:</strong> ${h}</p>
              </div>
              ${n.outerHTML}
            </body>
          </html>
        `),E.close()),x.onload=()=>{x.contentWindow?.print(),document.title="FRUIT",document.body.removeChild(x)}}else console.error("No se encontr\xF3 el contenido a imprimir.")}static \u0275fac=function(e){return new(e||i)(T(G),T(oe),T(ae))};static \u0275cmp=R({type:i,selectors:[["app-game-history"]],standalone:!0,features:[j],decls:54,vars:46,consts:[[1,"mb-6","p-4","bg-white","rounded-lg","shadow-md"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"relative","flex-1"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text",1,"w-full","pl-10","pr-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition","duration-150","ease-in-out",3,"ngModelChange","input","ngModel","placeholder"],[1,"flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","px-4","py-2","bg-white","border","border-gray-300","rounded-lg","text-sm","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","transition","duration-150","ease-in-out",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"ml-2","h-5","w-5",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2",4,"ngIf"],["class","fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",4,"ngIf"],[1,"py-10"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","table-auto"],[1,"bg-[#0D92F4]","text-white"],[1,"px-4","py-3","text-left","text-sm","font-medium","uppercase","tracking-wider","whitespace-nowrap"],["class","odd:bg-gray-50 even:bg-gray-100 hover:bg-gray-200",4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","mt-6","space-x-2"],[1,"px-4","py-2","text-sm","font-medium","text-gray-500","bg-gray-100","border","border-gray-300","rounded-md","hover:bg-gray-200","hover:text-gray-700","transition-colors","duration-300",3,"click","disabled","ngClass"],["class","px-4 py-2 text-sm font-medium border rounded-md transition-colors duration-300",3,"ngClass","click",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 9l4-4 4 4m0 6l-4 4-4-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"fixed","inset-0","flex","items-center","justify-center","z-50","bg-black","bg-opacity-50"],[1,"bg-white","rounded-lg","shadow-lg","w-4/5","max-w-lg"],[1,"px-4","pt-4","border-b","border-gray-200"],[1,"text-xl","font-bold","text-gray-800","m-0"],[1,"p-6","max-h-[70vh]","overflow-y-auto"],["id","print-content",1,"space-y-6"],["class","text-gray-700",4,"ngFor","ngForOf"],[1,"p-4","border-t","border-gray-200","flex","justify-end"],[1,"px-6","py-2","bg-red-500","text-white","text-sm","font-semibold","rounded-lg","shadow","hover:bg-red-600","focus:outline-none","focus:ring","focus:ring-red-300","transition",3,"click"],[1,"ml-4","px-6","py-2","bg-blue-500","text-white","text-sm","font-semibold","rounded-lg","shadow","hover:bg-blue-600","focus:outline-none","focus:ring","focus:ring-blue-300","transition",3,"click"],[1,"text-gray-700"],[1,"font-semibold"],[1,"flex","items-center","space-x-2"],[1,"text-sm","text-gray-600"],["class","text-green-500 text-lg font-bold",4,"ngIf"],["class","text-red-500 text-lg font-bold",4,"ngIf"],["class","text-sm text-red-500",4,"ngIf"],["class","mt-6 border-t border-gray-300",4,"ngIf"],[1,"text-green-500","text-lg","font-bold"],[1,"text-red-500","text-lg","font-bold"],[1,"text-sm","text-red-500"],[1,"mt-6","border-t","border-gray-300"],[1,"odd:bg-gray-50","even:bg-gray-100","hover:bg-gray-200"],[1,"px-4","py-4","text-sm","text-gray-700","whitespace-nowrap"],[1,"px-4","py-4","text-sm","font-semibold",3,"ngClass"],[1,"px-4","py-2","bg-blue-500","text-white","rounded-lg","hover:bg-blue-600","transition-colors","duration-300",3,"click"],[1,"px-4","py-2","text-sm","font-medium","border","rounded-md","transition-colors","duration-300",3,"click","ngClass"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),y(),o(4,"svg",4),b(5,"path",5),r()(),w(),o(6,"input",6),p(7,"translate"),U("ngModelChange",function(m){return V(a.searchTerm,m)||(a.searchTerm=m),m}),v("input",function(){return a.searchGameRooms()}),r()(),o(8,"div",7)(9,"button",8),v("click",function(){return a.toggleSort("code")}),o(10,"span"),s(11),p(12,"translate"),r(),y(),o(13,"svg",9),_(14,ce,1,0,"path",10)(15,me,1,1,"path",11),r()(),w(),o(16,"button",8),v("click",function(){return a.toggleSort("createdAt")}),o(17,"span"),s(18),p(19,"translate"),r(),y(),o(20,"svg",9),_(21,ge,1,0,"path",10)(22,ue,1,1,"path",11),r()()()()(),_(23,we,16,10,"div",12),w(),o(24,"div",13)(25,"div",14)(26,"div",15)(27,"table",16)(28,"thead",17)(29,"tr")(30,"th",18),s(31,"Id"),r(),o(32,"th",18),s(33),p(34,"translate"),r(),o(35,"th",18),s(36),p(37,"translate"),r(),o(38,"th",18),s(39),p(40,"translate"),r(),o(41,"th",18),s(42),p(43,"translate"),r()()(),o(44,"tbody"),_(45,Te,13,8,"tr",19),r()()()(),o(46,"div",20)(47,"button",21),v("click",function(){return a.prevPage()}),s(48),p(49,"translate"),r(),_(50,Ae,2,2,"button",22),o(51,"button",21),v("click",function(){return a.nextPage()}),s(52),p(53,"translate"),r()()()),e&2&&(t(6),F("placeholder",c(7,23,"GAME_ROOM.SEARCH_PLACEHOLDER")),L("ngModel",a.searchTerm),t(5),g(c(12,25,"GAME_ROOM.SORT_BY_CODE")),t(2),l("ngClass",P(41,se,a.sortField==="code"&&a.sortDirection==="desc")),t(),l("ngIf",a.sortField!=="code"),t(),l("ngIf",a.sortField==="code"),t(3),g(c(19,27,"GAME_ROOM.SORT_BY_DATE")),t(2),l("ngClass",P(43,se,a.sortField==="createdAt"&&a.sortDirection==="desc")),t(),l("ngIf",a.sortField!=="createdAt"),t(),l("ngIf",a.sortField==="createdAt"),t(),l("ngIf",a.showModal),t(10),g(c(34,29,"TABLE.CODE")),t(3),g(c(37,31,"TABLE.SCORE")),t(3),g(c(40,33,"TABLE.DURATION")),t(3),g(c(43,35,"TABLE.ACTIONS")),t(3),l("ngForOf",a.paginatedData),t(2),l("disabled",a.currentPage===1)("ngClass",a.currentPage===1?"opacity-50 cursor-not-allowed":""),t(),u(" \xAB ",c(49,37,"BUTTON_NAVIGATION_TABLE.PREVIOUS")," "),t(2),l("ngForOf",$(45,pe).constructor(a.totalPages)),t(),l("disabled",a.currentPage===a.totalPages)("ngClass",a.currentPage===a.totalPages?"opacity-50 cursor-not-allowed":""),t(),u(" ",c(53,39,"BUTTON_NAVIGATION_TABLE.NEXT"),"\xBB "))},dependencies:[q,W,z,K,re,ne,ie,Z,ee,te]})};export{O as default};
